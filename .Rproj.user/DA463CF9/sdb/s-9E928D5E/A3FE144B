{
    "collab_server" : "",
    "contents" : "# Hello, world!\n#\n# This is an example function named 'hello'\n# which prints 'Hello, world!'.\n#\n# You can learn more about package authoring with RStudio at:\n#\n#   http://r-pkgs.had.co.nz/\n#\n# Some useful keyboard shortcuts for package authoring:\n#\n#   Build and Reload Package:  'Ctrl + Shift + B'\n#   Check Package:             'Ctrl + Shift + E'\n#   Test Package:              'Ctrl + Shift + T'\n\npmh = function(data = j_sight,lambda=0){\n\n  if(1==2){\n    lambda = 0\n  }\n\n  log0 = function(x){\n    if(is.infinite(log(x))){\n      res = 0\n    }else{\n      res = log(x)\n    }\n    return(res)\n  }\n\n  p_ij = dat/sum(dat)\n  n.row = n.col = nrow(p_ij)\n  dp_ij = matrix(NA,n.row,n.col)\n\n\n  A = (2^lambda)/((2^lambda)-1)\n  A2 = 1/log0(2)\n  p_id = c()\n  p_di = c()\n  p1rat = p2rat = c()\n  him = enm = lenm = pistar = c()\n\n  alln = sum(dat)\n\n  #尺度＝０\n  #p_ij = cbind(c(1/18,1/18,1/18),c(1/18,3/18,1/18),c(1/18,2/18,7/18))\n  #尺度＝１\n  #p_ij = cbind(c(0,7/18,0),c(0,0,0),c(0,11/18,0))\n  #rmultinom(1,100,c(3/9,2/9,1/18,1/18,1/18,1/18,1/9,1/18,1/18))\n\n  toriihim = toriienm = 1\n  for(i in 1:n.row){\n    p_id[i] = sum(p_ij[i,])\n    p_di[i] = sum(p_ij[,i])\n    p1rat[i] = p_id[i]/(p_id[i]+p_di[i])\n    p2rat[i] = p_di[i]/(p_id[i]+p_di[i])\n    him[i] = 1 - A*(1-((p1rat[i])^(lambda+1))-((p2rat[i])^(lambda+1)))\n    enm[i] = 1 + A2*(p1rat[i]*log0(p1rat[i])+p2rat[i]*log0(p2rat[i]))\n    pistar[i] = (p_id[i]+p_di[i])/2\n    toriihim = toriihim * (him[i]^pistar[i])\n    toriienm = toriienm * (enm[i]^pistar[i])\n  }\n\n  #toriihimはlambda!=0の提案尺度に入れたやつ！\n  #toriienmはlambda=0の提案尺度に入れたやつ！\n\n\n  #微分したやつに入れてる！\n  if(lambda != 0){\n    for(i in 1:n.row){\n      for(j in 1:n.col){\n        if(i == j){\n          dp_ij[i,j] = toriihim * (log0(him[i])+A*(lambda+1)*(p_id[i]^lambda-p_di[i]^lambda)*(p_di[i]-p_id[i])/(2*him[i]*(p_id[i]+p_di[i])^(lambda+1)))\n        }else{\n          dp_ij[i,j]= (1/2) * toriihim * (log0(him[i])+A*(lambda+1)*(p_id[i]^lambda-p_di[i]^lambda)*p_di[i]/(him[i]*(p_id[i]+p_di[i])^(lambda+1)) + log0(him[j])+A*(lambda+1)*(p_di[j]^lambda-p_id[j]^lambda)*p_id[j]/(him[j]*(p_id[j]+p_di[j])^(lambda+1)))\n        }\n      }\n    }\n\n    Sigma1 = Sigma22 = 0\n    for(i in 1:n.row){\n      for(j in 1:n.col){\n        Sigma1 = Sigma1 + p_ij[i,j]*(dp_ij[i,j]^2)\n        Sigma22 = Sigma22 + p_ij[i,j]*dp_ij[i,j]\n      }\n    }\n    Sigma2 = Sigma22^2\n\n    Sigma = Sigma1 - Sigma2\n\n    CI.low = toriihim - qnorm(1-0.05/2)*sqrt(Sigma/alln)\n    CI.upper = toriihim + qnorm(1-0.05/2)*sqrt(Sigma/alln)\n\n  }\n\n\n  if(lambda == 0){\n    for(i in 1:n.row){\n      for(j in 1:n.col){\n        if(i == j){\n          dp_ij[i,j] = toriienm * (log0(enm[i])+A2*(p_di[i]-p_id[i])*log0(p_id[i]/p_di[i])/(2*(p_id[i]+p_di[i])*enm[i]))\n        }else{\n          dp_ij[i,j] = toriienm *(1/2) * (log0(enm[i])+A2*p_di[i]*log0(p_id[i]/p_di[i])/((p_id[i]+p_di[i])*enm[i]) + log0(enm[j])-A2*p_id[j]*log0(p_id[j]/p_di[j])/((p_id[j]+p_di[j])*enm[j]))\n        }\n      }\n    }\n\n\n    Sigma1 = Sigma22 = 0\n    for(i in 1:n.row){\n      for(j in 1:n.col){\n        Sigma1 = Sigma1 + p_ij[i,j]*(dp_ij[i,j]^2)\n        Sigma22 = Sigma22 + p_ij[i,j]*dp_ij[i,j]\n      }\n    }\n\n    Sigma2 = Sigma22^2\n\n    Sigma = Sigma1 - Sigma2\n\n\n    CI.low = toriienm - qnorm(1-0.05/2)*sqrt(Sigma/alln)\n    CI.upper = toriienm + qnorm(1-0.05/2)*sqrt(Sigma/alln)\n\n    toriihim = toriienm\n  }\n\n\n  #print(paste(c(\"lambda\",lambda),collapse=\"=\"))\n  #print(\"隔たり\")\n  #print(toriihim)\n  #print(\"推定分散\")\n  #print(Sigma)\n  #print(\"信頼区間\")\n  #print(c(CI.low ,CI.upper))\n\n  return(list(dep = toriihim,vari = Sigma,CI = c(CI.low ,CI.upper)))\n\n}\n\n",
    "created" : 1489661305296.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1613257572",
    "id" : "A3FE144B",
    "lastKnownWriteTime" : 1489662402,
    "last_content_update" : 1489662402103,
    "path" : "~/pmh/R/pmh.R",
    "project_path" : "R/pmh.R",
    "properties" : {
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}